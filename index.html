<!-- index.html (CLEAN + DUST + PACK/MAP MODALS + COMMISSION MODALS + SEO/SHARE/SCHEMA + CART/CHECKOUT) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Digital Parchment Textures & Aged Paper Backgrounds | Lace & Leather</title>

  <meta name="description" content="Digital parchment, aged textures, grimoire surfaces, overlays, and ritual map assets for TTRPG creators, designers, and bookbinders." />
  <link rel="canonical" href="https://laceleatherarcane.com/" />

  <!-- Theme / PWA -->
  <meta name="theme-color" content="#0b0f14" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./favicon.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <!-- Pinterest domain verify -->
  <meta name="p:domain_verify" content="35ebca8082bfd2bfe5109b2afea18305" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Lace & Leather" />
  <meta property="og:title" content="Digital Parchment Textures & Aged Paper Backgrounds | Lace & Leather" />
  <meta property="og:description" content="Digital parchment, aged textures, grimoire surfaces, overlays, and ritual map assets for TTRPG creators, designers, and bookbinders." />
  <meta property="og:url" content="https://laceleatherarcane.com/" />
  <meta property="og:image" content="https://laceleatherarcane.com/assets/og-cover.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Digital Parchment Textures & Aged Paper Backgrounds | Lace & Leather" />
  <meta name="twitter:description" content="Digital parchment, aged textures, grimoire surfaces, overlays, and ritual map assets for TTRPG creators, designers, and bookbinders." />
  <meta name="twitter:image" content="https://laceleatherarcane.com/assets/og-cover.png" />

  <!-- Structured Data (Organization + WebSite) -->
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://laceleatherarcane.com/#organization",
      "name": "Lace & Leather",
      "url": "https://laceleatherarcane.com/",
      "logo": "https://laceleatherarcane.com/assets/l&l_logo.png",
      "sameAs": [
        "https://instagram.com/lace.and.leather65",
        "https://pinterest.com/laceandleather65",
        "https://payhip.com/LaceLeather65",
        "https://www.etsy.com/shop/laceLeatherArcane"
      ]
    },
    {
      "@type": "WebSite",
      "@id": "https://laceleatherarcane.com/#website",
      "url": "https://laceleatherarcane.com/",
      "name": "Lace & Leather",
      "publisher": { "@id": "https://laceleatherarcane.com/#organization" }
    }
  ]
}
  </script>

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Fixed background layer -->
  <div class="bg" aria-hidden="true"></div>

  <!-- Subtle dust particles over the background -->
  <div class="dust" aria-hidden="true">
    <span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span>
    <span></span><span></span><span></span><span></span>
  </div>

  <!-- Floating Cart Button -->
  <button class="cart-fab" id="openCart" type="button" aria-label="Open cart">
    <span class="cart-fab-label">Cart</span>
    <span class="cart-badge" id="cartCount" aria-label="Items in cart">0</span>
  </button>

  <main class="wrap">
    <!-- HERO (open air, no glass) -->
    <header class="hero">
      <div class="brand-title">Lace &amp; Leather</div>
      <div class="hero-inner">
        <!-- Single framed logo image -->
        <img class="logo" src="./assets/l&l_logo.png" alt="Lace &amp; Leather" />

        <p class="tagline">Digital textures for artists, designers &amp; bookmakers.</p>
        <p class="subtag">Aged parchment · ritual surfaces · dark elegance</p>

        <!-- PROCESS (glass stays) -->
        <section id="process" class="glass section" aria-label="Process">
          <h2 class="h2">Process</h2>
          <p class="muted">
            Built like a workshop: stains, fibers, and surface wear — curated so your text stays legible.
          </p>

          <div class="creation-grid" aria-label="Creation photos">
            <img src="./assets/creation/creation_1.png" alt="Creation process photo 1" loading="lazy" />
            <img src="./assets/creation/creation_2.png" alt="Creation process photo 2" loading="lazy" />
            <img src="./assets/creation/creation_3.png" alt="Creation process photo 3" loading="lazy" />
            <img src="./assets/creation/creation_4.png" alt="Creation process photo 4" loading="lazy" />
          </div>

          <p class="shop-line muted">Shop now</p>

          <!-- SOCIAL ICONS (these are the only outbound things in the hero) -->
          <div class="social-icons" aria-label="Shop and follow">
            <a class="seal" href="https://payhip.com/LaceLeather65" target="_blank" rel="noopener noreferrer" aria-label="Payhip">
              <img src="./assets/social-icons/payhip-icon.PNG" alt="Payhip" />
            </a>

            <a class="seal" href="https://www.etsy.com/shop/laceLeatherArcane" target="_blank" rel="noopener noreferrer" aria-label="Etsy">
              <img src="./assets/social-icons/etsy-icon.PNG" alt="Etsy" />
            </a>

            <a class="seal" href="https://instagram.com/lace.and.leather65" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
              <img src="./assets/social-icons/instagram-icon.PNG" alt="Instagram" />
            </a>

            <a class="seal" href="https://pinterest.com/laceandleather65" target="_blank" rel="noopener noreferrer" aria-label="Pinterest">
              <img src="./assets/social-icons/pinterest-icon.PNG" alt="Pinterest" />
            </a>
          </div>
        </section>
      </div>
    </header>

    <!-- PRODUCTS / VOLUMES -->
    <section class="glass section" aria-label="Packs">
      <h2 class="h2">Browse Packs</h2>
      <p class="muted">Tap a cover to preview the full set. (No downloads here — this is the front porch.)</p>

      <div class="packs" aria-label="Pack list">
        <!-- Grimoire Pages -->
        <div class="pack" role="button" tabindex="0" data-pack="grimoire" aria-label="Preview Grimoire Pages pack">
          <img src="./assets/grimoire/grim-thumb.png" alt="Grimoire pack preview" loading="lazy" />
          <div class="pack-meta">
            <div class="pack-title">Grimoire Pages</div>
            <div class="pack-note muted">Click to preview all pages</div>
          </div>
          <div class="pack-actions" aria-label="Purchase actions">
            <button class="pack-buy" type="button" data-add="grimoire">Add to cart</button>
          </div>
        </div>

        <!-- Mapmaker Sheets -->
        <div class="pack" role="button" tabindex="0" data-pack="mapmaker" aria-label="Preview Mapmaker Sheets pack">
          <img src="./assets/mapmaker/mapmaker-cover.png" alt="Mapmaker pack preview" loading="lazy" />
          <div class="pack-meta">
            <div class="pack-title">Mapmaker Sheets</div>
            <div class="pack-note muted">Click to preview all sheets</div>
          </div>
          <div class="pack-actions" aria-label="Purchase actions">
            <button class="pack-buy" type="button" data-add="mapmaker">Add to cart</button>
          </div>
        </div>

        <!-- Vol One -->
        <div class="pack" role="button" tabindex="0" data-pack="volone" aria-label="Preview Light Aged Parchment Vol One pack">
          <img
            src="./assets/vol-one/vol-1-thumbnail.png"
            alt="Vol One light parchment preview"
            loading="lazy"
          />
          <div class="pack-meta">
            <div class="pack-title">Light Aged Parchment — Vol. One</div>
            <div class="pack-note muted">Click to preview all textures</div>
          </div>
          <div class="pack-actions" aria-label="Purchase actions">
            <button class="pack-buy" type="button" data-add="volone">Add to cart</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PAYMENT / CHECKOUT INFO (optional clarity, keeps trust high) -->
    <section class="glass section" aria-label="Checkout">
      <h2 class="h2">Checkout</h2>
      <p class="muted checkout-note">
        Checkout is handled through PayPal. After payment, you’ll receive your download links privately.
        (This site is the front porch — previews live here, full-resolution delivery happens after purchase.)
      </p>
      <button class="pack-buy checkout-open" type="button" id="openCartInline">Open cart</button>
    </section>

    <!-- MAP COMMISSIONS -->
    <section id="maps" class="glass section section-maps" aria-label="Custom fantasy maps">
      <h2 class="h2">Custom Fantasy Maps</h2>
      <p class="muted">
        Hand-drawn parchment cartography for D&amp;D campaigns, novels, and worldbuilding.
      </p>

      <div class="maps-grid" aria-label="Map examples">
        <figure class="map-card" data-map="suneen">
          <div class="map-thumb">
            <img src="./assets/maps/suneen-reef.png" alt="Fantasy map example — Suneen Reef" loading="lazy" />
          </div>
          <figcaption class="map-caption">
            <span class="map-name">Suneen Reef</span>
            <span class="map-tagline">ringed reef &amp; coastal settlements</span>
          </figcaption>
        </figure>

        <figure class="map-card" data-map="whispering">
          <div class="map-thumb">
            <img src="./assets/maps/whispering-bay.png" alt="Fantasy map example — Whispering Bay" loading="lazy" />
          </div>
          <figcaption class="map-caption">
            <span class="map-name">Whispering Bay</span>
            <span class="map-tagline">shadowed shores &amp; hidden coves</span>
          </figcaption>
        </figure>
      </div>

      <div class="maps-copy">
        <p>
          Islands, regions, and towns illustrated on aged parchment with custom coastlines, labels, and compasses —
          tuned for print and digital campaigns alike.
        </p>
        <p>
          <strong>Deliverables:</strong> High-resolution PNG/JPG, print-ready at 300 DPI, optional transparent background.
        </p>
        <p>
          <strong>Availability:</strong> 3 custom map slots open each month.
        </p>
      </div>

      <p class="maps-ward muted">
        Protection ward: previews stay here. No reuse, resale, or training data. Full-resolution files are delivered
        privately to clients.
      </p>

      <div class="maps-cta">
        <button class="maps-btn" type="button" id="openCommission">
          <img class="wax-seal-img" src="./assets/custom-maps-button.png" alt="Request a custom map slot" />
        </button>

        <!-- Optional: map deposit as a real SKU in the cart -->
        <div class="maps-cartline">
          <button class="pack-buy" type="button" data-add="mapdeposit">Add $50 map deposit to cart</button>
        </div>
      </div>
    </section>

    <!-- SEO copy block -->
    <section class="section section-copy">
      <h2>Digital aged parchment textures for designers, authors &amp; bookmakers</h2>
      <p>
        Lace &amp; Leather creates <strong>digital parchment textures</strong> for artists, writers,
        bookbinders, and TTRPG creators. Every page is built as a high-resolution
        <strong>printable vintage paper</strong> file you can drop straight into your layouts
        for journals, notebooks, book interiors, spellbooks, and campaign logs.
      </p>
      <p>
        Packs are designed for <strong>commercial use</strong> and tested across common
        workflows: <strong>scrapbooking &amp; journaling</strong>, bookbinding and
        <strong>book arts</strong>, fantasy <strong>TTRPG map-making</strong>, tarot
        and oracle decks, and digital collages. Use them as <strong>aged paper
        backgrounds</strong>, subtle <strong>graphic design overlays</strong>, or full
        printable pages for DIY projects.
      </p>
      <p>
        If you need believable, high-detail parchment that prints cleanly and works
        with layered designs, these <strong>digital textures</strong> were built for you.
        No stock-photo noise, no fake grunge — just consistent, archival-feeling
        pages that make your work look like it has a history.
      </p>
    </section>

    <!-- FOOTER -->
    <footer class="site-footer">
      <p class="footer-sub">
        Website by
        <a href="https://blackstagweb.com" rel="noopener noreferrer">Black Stag Web Studio</a>
      </p>
      <div class="footer-inner">
        <div class="brand">Lace &amp; Leather</div>
        <div class="muted">
          Digital texture packs · PNG/JPG · Instant delivery via shop links
        </div>
      </div>
    </footer>
  </main>

  <!-- PACKS MODAL -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close></div>

    <div class="modal-panel glass" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-head">
        <div class="modal-left">
          <button class="wax-btn back-btn" type="button" data-back aria-label="Back to collage">
            <img src="./assets/back-button.PNG" alt="Back" />
          </button>

          <div>
            <div id="modalTitle" class="modal-title">Preview</div>
            <div id="modalSub" class="modal-sub muted"></div>
          </div>
        </div>

        <button class="wax-btn close-btn" type="button" data-close aria-label="Close preview">
          <img src="./assets/x-button.PNG" alt="Close" />
        </button>
      </div>

      <div class="modal-body">
        <div class="collage" id="collage" aria-label="Pack preview collage"></div>

        <div class="viewer" id="viewer" aria-label="Large preview" aria-hidden="true">
          <div id="viewerImg" class="viewer-img" role="img" aria-label="Large preview image"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MAPS MODAL -->
  <div class="modal" id="mapModal" aria-hidden="true">
    <div class="modal-backdrop" data-map-close></div>

    <div class="modal-panel glass" role="dialog" aria-modal="true" aria-labelledby="mapModalTitle">
      <div class="modal-head">
        <div class="modal-left">
          <button class="wax-btn back-btn" type="button" data-map-back aria-label="Back to maps">
            <img src="./assets/back-button.PNG" alt="Back" />
          </button>

          <div>
            <div id="mapModalTitle" class="modal-title">Custom Map</div>
            <div id="mapModalSub" class="modal-sub muted">Preview</div>
          </div>
        </div>

        <button class="wax-btn close-btn" type="button" data-map-close aria-label="Close map preview">
          <img src="./assets/x-button.PNG" alt="Close" />
        </button>
      </div>

      <div class="modal-body">
        <div class="viewer map-viewer" id="mapViewer" aria-label="Large map preview">
          <div id="mapViewerImg" class="viewer-img" role="img" aria-label="Large map preview image"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CART / CHECKOUT MODAL -->
  <div class="modal" id="cartModal" aria-hidden="true">
    <div class="modal-backdrop" data-cart-close></div>

    <div class="modal-panel glass cart-panel" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
      <div class="modal-head">
        <div class="modal-left">
          <div>
            <div id="cartTitle" class="modal-title">Cart</div>
            <div class="modal-sub muted" id="cartSub">Ready when you are.</div>
          </div>
        </div>

        <button class="wax-btn close-btn" type="button" data-cart-close aria-label="Close cart">
          <img src="./assets/x-button.PNG" alt="Close" />
        </button>
      </div>

      <div class="modal-body cart-body">
        <div class="cart-empty muted" id="cartEmpty" hidden>Your cart is empty.</div>

        <div class="cart-list" id="cartList" aria-label="Cart items"></div>

        <div class="cart-summary" aria-label="Cart summary">
          <div class="cart-row">
            <span class="muted">Subtotal</span>
            <strong id="cartSubtotal">$0.00</strong>
          </div>
          <div class="cart-row small muted">
            PayPal will show the final total before you confirm.
          </div>
        </div>

        <div class="checkout-block" aria-label="Checkout">
          <div class="checkout-title">Checkout</div>

          <label class="field">
            <span class="muted">Email for delivery</span>
            <input class="input" id="buyerEmail" type="email" inputmode="email" placeholder="you@example.com" />
          </label>

          <label class="field">
            <span class="muted">Order note (optional)</span>
            <input class="input" id="buyerNote" type="text" placeholder="Any special request…" maxlength="80" />
          </label>

          <div class="order-id">
            <span class="muted">Order ID:</span>
            <strong id="orderId">—</strong>
            <button class="mini-btn" type="button" id="copyOrder">Copy</button>
          </div>

          <button class="pay-btn" type="button" id="payNow">
            Pay with PayPal
          </button>

          <p class="muted checkout-fineprint">
            Important: add the Order ID in your PayPal note so we can match your payment to your files.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- COMMISSION ENVELOPE MODAL (fullscreen, no scroll) -->
  <div class="modal" id="commissionModal" aria-hidden="true">
    <div class="modal-backdrop commission-backdrop" data-commission-close></div>

    <div class="modal-panel commission-panel" role="dialog" aria-modal="true" aria-labelledby="commissionTitle">
      <div class="commission-inner">
        <div class="commission-bg" aria-hidden="true"></div>

        <button class="wax-btn commission-close" type="button" data-commission-close aria-label="Close commission envelope">
          <img src="./assets/x-button.PNG" alt="Close" />
        </button>

        <button class="commission-envelope-btn" type="button" id="commissionAdvance" aria-label="Open commission envelope">
          <img
            id="commissionImg"
            class="commission-envelope-img"
            src="./commission-modal-assets/envelope-closed.png"
            alt="Closed parchment envelope"
          />
        </button>
      </div>
    </div>
  </div>

  <!-- COMMISSION LETTER MODAL (scrollable) -->
  <div class="modal" id="commissionLetterModal" aria-hidden="true">
    <div class="modal-backdrop letter-backdrop" data-letter-close></div>

    <div class="modal-panel glass letter-panel" role="dialog" aria-modal="true" aria-labelledby="commissionLetterTitle">
      <div class="modal-head">
        <div class="modal-left">
          <div>
            <div id="commissionLetterTitle" class="modal-title">Commission a Custom Map</div>
            <div class="modal-sub muted">Instructions &amp; contact</div>
          </div>
        </div>

        <button class="wax-btn close-btn" type="button" data-letter-close aria-label="Close commission letter">
          <img src="./assets/x-button.PNG" alt="Close" />
        </button>
      </div>

      <div class="modal-body letter-body">
        <div class="letter-bg" aria-hidden="true"></div>

        <div class="letter-stack">
          <img
            src="./commission-modal-assets/commission-letter.png"
            alt="Commission instructions letter"
            class="letter-img"
          />

          <a
            class="map-slot-btn"
            id="mapSlotBtn"
            href="https://docs.google.com/forms/d/e/1FAIpQLSf_DSOolY4i1vQgBOu9oJriiGl_ViNXpJk7jBLEiRqkxvWuzA/viewform"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="Claim a custom map slot (opens form)"
          >
            <img src="./commission-modal-assets/map-slot-button.png" alt="Claim map slot" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Inline JS -->
  <script>
    (() => {
      "use strict";

      /* =========================
         PAYPAL CONFIG
         =========================
         1) Create your PayPal
         2) Create your PayPal.me handle
         3) Replace the handle below
      */
      const PAYPAL_ME_HANDLE = "YOURHANDLE"; // <-- REPLACE (no @)
      const PAYPAL_CURRENCY = "USD";

      /* =========================
         CART PRODUCTS
         =========================
         Prices are placeholders. Change anytime.
      */
      const PRODUCTS = {
        grimoire:   { name: "Grimoire Pages (12)", price: 15.00 },
        mapmaker:   { name: "Mapmaker Sheets (7)", price: 15.00 },
        volone:     { name: "Light Aged Parchment — Vol. One (12)", price: 15.00 },
        mapdeposit: { name: "Custom Map Deposit", price: 50.00 }
      };

      const CART_KEY = "ll_cart_v1";

      // Keep scroll position when modals open/close
      let scrollPosition = 0;

      const lockScroll = () => {
        scrollPosition = window.scrollY || document.documentElement.scrollTop || 0;
        document.documentElement.classList.add("no-scroll");
        document.body.style.position = "fixed";
        document.body.style.top = `-${scrollPosition}px`;
        document.body.style.left = "0";
        document.body.style.right = "0";
        document.body.style.width = "100%";
      };

      const unlockScroll = () => {
        document.documentElement.classList.remove("no-scroll");
        document.body.style.position = "";
        document.body.style.top = "";
        document.body.style.left = "";
        document.body.style.right = "";
        document.body.style.width = "";
        window.scrollTo(0, scrollPosition || 0);
      };

      const money = (n) => {
        const x = Number(n || 0);
        return x.toLocaleString(undefined, { style:"currency", currency: PAYPAL_CURRENCY });
      };

      const safeId = () => {
        // short, human-readable: LL-7H2K9D
        const chars = "ABCDEFGHJKMNPQRSTUVWXYZ23456789";
        let out = "LL-";
        for (let i=0;i<6;i++) out += chars[Math.floor(Math.random()*chars.length)];
        return out;
      };

      const readCart = () => {
        try {
          const raw = localStorage.getItem(CART_KEY);
          const data = raw ? JSON.parse(raw) : {};
          return (data && typeof data === "object") ? data : {};
        } catch {
          return {};
        }
      };

      const writeCart = (cart) => {
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
      };

      const cartCount = (cart) => Object.values(cart).reduce((a,b)=>a + (Number(b)||0), 0);

      const cartSubtotal = (cart) => {
        let sum = 0;
        for (const [key, qty] of Object.entries(cart)) {
          const p = PRODUCTS[key];
          if (!p) continue;
          sum += p.price * Number(qty || 0);
        }
        return Math.max(0, sum);
      };

      const setBadge = () => {
        const el = document.getElementById("cartCount");
        if (!el) return;
        const c = readCart();
        el.textContent = String(cartCount(c));
      };

      const addToCart = (key, qty=1) => {
        const p = PRODUCTS[key];
        if (!p) return;
        const cart = readCart();
        cart[key] = Math.min(99, (Number(cart[key]||0) + Number(qty||1)));
        writeCart(cart);
        setBadge();
      };

      const setQty = (key, qty) => {
        const cart = readCart();
        const n = Number(qty || 0);
        if (n <= 0) delete cart[key];
        else cart[key] = Math.min(99, n);
        writeCart(cart);
        setBadge();
      };

      /* =========================
         EXISTING PACK/MAP MODALS
         ========================= */
      const PACKS = {
        grimoire: {
          title: "Grimoire Pages",
          sub: "Preview (12 pages)",
          images: [
            "./assets/grimoire/grim-1.PNG",
            "./assets/grimoire/grim-2.PNG",
            "./assets/grimoire/grim-3.PNG",
            "./assets/grimoire/grim-4.PNG",
            "./assets/grimoire/grim-5.PNG",
            "./assets/grimoire/grim-6.PNG",
            "./assets/grimoire/grim-7.PNG",
            "./assets/grimoire/grim-8.PNG",
            "./assets/grimoire/grim-9.PNG",
            "./assets/grimoire/grim-10.PNG",
            "./assets/grimoire/grim-11.PNG",
            "./assets/grimoire/grim-12.PNG"
          ]
        },
        mapmaker: {
          title: "Mapmaker Sheets",
          sub: "Preview (7 sheets)",
          images: [
            "./assets/mapmaker/map_3.png",
            "./assets/mapmaker/map_4.png",
            "./assets/mapmaker/map_5.png",
            "./assets/mapmaker/map_6.png",
            "./assets/mapmaker/map_7.png",
            "./assets/mapmaker/map_8.png",
            "./assets/mapmaker/map_9.png"
          ]
        },
        volone: {
          title: "Light Aged Parchment — Vol. One",
          sub: "Preview (12 textures)",
          images: [
            "./assets/vol-one/parchment-light_1.jpg",
            "./assets/vol-one/parchment-light_2.jpg",
            "./assets/vol-one/parchment-light_3.jpg",
            "./assets/vol-one/parchment-light_4.jpg",
            "./assets/vol-one/parchment-light_5.jpg",
            "./assets/vol-one/parchment-light_6.jpg",
            "./assets/vol-one/parchment-light_7.jpg",
            "./assets/vol-one/parchment-light_8.jpg",
            "./assets/vol-one/parchment-light_9.jpg",
            "./assets/vol-one/parchment-light_10.jpg",
            "./assets/vol-one/parchment-light_11.jpg",
            "./assets/vol-one/parchment-light_12.jpg"
          ]
        }
      };

      const MAPS = {
        suneen: { title: "Suneen Reef", sub: "Ringed reef & coastal settlements", src: "./assets/maps/suneen-reef.png" },
        whispering: { title: "Whispering Bay", sub: "Shadowed shores & hidden coves", src: "./assets/maps/whispering-bay.png" }
      };

      // Packs modal elements
      const modal = document.getElementById("modal");
      const collage = document.getElementById("collage");
      const viewer = document.getElementById("viewer");
      const viewerImg = document.getElementById("viewerImg");
      const packTitleEl = document.getElementById("modalTitle");
      const packSubEl = document.getElementById("modalSub");
      const backBtn = document.querySelector("[data-back]");

      // Maps modal elements
      const mapModal = document.getElementById("mapModal");
      const mapViewerImg = document.getElementById("mapViewerImg");
      const mapTitleEl = document.getElementById("mapModalTitle");
      const mapSubEl = document.getElementById("mapModalSub");
      const mapsGrid = document.querySelector(".maps-grid");

      // Commission modals
      const commissionModal = document.getElementById("commissionModal");
      const commissionImg = document.getElementById("commissionImg");
      const commissionAdvanceBtn = document.getElementById("commissionAdvance");
      const commissionLetterModal = document.getElementById("commissionLetterModal");
      const mapSlotBtn = document.getElementById("mapSlotBtn");

      const COMMISSION_STEPS = [
        { src: "./commission-modal-assets/envelope-closed.png", alt: "Closed parchment envelope" },
        { src: "./commission-modal-assets/envelope-open-letter.png", alt: "Open parchment envelope revealing a folded letter" },
        { src: "./commission-modal-assets/envelope-empty.png", alt: "Open empty parchment envelope" }
      ];
      let commissionStep = 0;
      let commissionAnimating = false;

      const setMode = (mode) => {
        if (mode === "viewer") {
          modal.classList.add("mode-viewer");
          viewer.setAttribute("aria-hidden", "false");
          backBtn.style.display = "inline-flex";
        } else {
          modal.classList.remove("mode-viewer");
          viewer.setAttribute("aria-hidden", "true");
          backBtn.style.display = "none";
          viewerImg.style.backgroundImage = "";
        }
      };

      const openModal = (key) => {
        const pack = PACKS[key];
        if (!pack) return;

        packTitleEl.textContent = pack.title;
        packSubEl.textContent = pack.sub;

        collage.innerHTML = "";
        setMode("collage");

        pack.images.forEach((src, idx) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "tile";
          btn.setAttribute("data-view", src);
          btn.setAttribute("aria-label", `View image ${idx + 1}`);

          const face = document.createElement("div");
          face.className = "tile-face";
          face.style.backgroundImage = `url("${src}")`;

          const shield = document.createElement("span");
          shield.className = "tile-shield";
          shield.setAttribute("aria-hidden", "true");

          btn.appendChild(face);
          btn.appendChild(shield);
          collage.appendChild(btn);
        });

        modal.classList.add("open");
        modal.setAttribute("aria-hidden", "false");
        lockScroll();
      };

      const closeModal = () => {
        modal.classList.remove("open");
        modal.setAttribute("aria-hidden", "true");
        collage.innerHTML = "";
        setMode("collage");
        unlockScroll();
      };

      const openViewer = (src) => {
        if (!src) return;
        viewerImg.style.backgroundImage = `url("${src}")`;
        setMode("viewer");
        const body = modal.querySelector(".modal-body");
        if (body) body.scrollTop = 0;
      };

      const backToCollage = () => setMode("collage");

      // === MAP MODAL ===
      const openMapModal = (key) => {
        const map = MAPS[key];
        if (!map) return;

        mapTitleEl.textContent = map.title;
        mapSubEl.textContent = map.sub;
        mapViewerImg.style.backgroundImage = `url("${map.src}")`;

        mapModal.classList.add("open");
        mapModal.setAttribute("aria-hidden", "false");
        lockScroll();
      };

      const closeMapModal = () => {
        mapModal.classList.remove("open");
        mapModal.setAttribute("aria-hidden", "true");
        mapViewerImg.style.backgroundImage = "";
        unlockScroll();
      };

      // === COMMISSION MODALS ===
      const showCommissionStep = (index) => {
        const step = COMMISSION_STEPS[index];
        if (!step || !commissionImg) return;
        commissionImg.src = step.src;
        commissionImg.alt = step.alt;
      };

      const openCommissionModal = () => {
        commissionStep = 0;
        commissionAnimating = false;
        showCommissionStep(commissionStep);
        commissionModal.classList.add("open");
        commissionModal.setAttribute("aria-hidden", "false");
        lockScroll();
      };

      const openCommissionLetterModal = () => {
        commissionModal.classList.remove("open");
        commissionModal.setAttribute("aria-hidden", "true");

        commissionLetterModal.classList.add("open");
        commissionLetterModal.setAttribute("aria-hidden", "false");
      };

      const closeCommissionModals = () => {
        commissionModal.classList.remove("open");
        commissionModal.setAttribute("aria-hidden", "true");
        commissionLetterModal.classList.remove("open");
        commissionLetterModal.setAttribute("aria-hidden", "true");
        commissionStep = 0;
        commissionAnimating = false;
        unlockScroll();
      };

      const playCommissionSequence = () => {
        if (commissionAnimating) return;
        commissionAnimating = true;
        commissionStep = 0;
        showCommissionStep(commissionStep);

        setTimeout(() => { commissionStep = 1; showCommissionStep(commissionStep); }, 250);
        setTimeout(() => { commissionStep = 2; showCommissionStep(commissionStep); }, 550);
        setTimeout(() => { openCommissionLetterModal(); commissionAnimating = false; }, 900);
      };

      /* =========================
         CART MODAL
         ========================= */
      const cartModal = document.getElementById("cartModal");
      const cartList = document.getElementById("cartList");
      const cartEmpty = document.getElementById("cartEmpty");
      const cartSubtotalEl = document.getElementById("cartSubtotal");
      const buyerEmail = document.getElementById("buyerEmail");
      const buyerNote = document.getElementById("buyerNote");
      const orderIdEl = document.getElementById("orderId");
      const copyOrderBtn = document.getElementById("copyOrder");
      const payNowBtn = document.getElementById("payNow");

      let currentOrderId = "—";

      const openCart = () => {
        currentOrderId = safeId();
        orderIdEl.textContent = currentOrderId;
        renderCart();
        cartModal.classList.add("open");
        cartModal.setAttribute("aria-hidden", "false");
        lockScroll();
      };

      const closeCart = () => {
        cartModal.classList.remove("open");
        cartModal.setAttribute("aria-hidden", "true");
        unlockScroll();
      };

      const renderCart = () => {
        const cart = readCart();
        const keys = Object.keys(cart);

        cartList.innerHTML = "";

        if (keys.length === 0) {
          cartEmpty.hidden = false;
          cartList.innerHTML = "";
          cartSubtotalEl.textContent = money(0);
          setBadge();
          return;
        }

        cartEmpty.hidden = true;

        for (const key of keys) {
          const p = PRODUCTS[key];
          if (!p) continue;

          const qty = Number(cart[key] || 0);
          const row = document.createElement("div");
          row.className = "cart-item";

          row.innerHTML = `
            <div class="cart-item-main">
              <div class="cart-item-name">${p.name}</div>
              <div class="cart-item-price muted">${money(p.price)} each</div>
            </div>

            <div class="cart-item-controls" aria-label="Quantity controls">
              <button class="qty-btn" type="button" data-qty-minus="${key}" aria-label="Decrease quantity">−</button>
              <div class="qty-num" aria-label="Quantity">${qty}</div>
              <button class="qty-btn" type="button" data-qty-plus="${key}" aria-label="Increase quantity">+</button>
              <button class="remove-btn" type="button" data-remove="${key}" aria-label="Remove item">Remove</button>
            </div>
          `;

          cartList.appendChild(row);
        }

        cartSubtotalEl.textContent = money(cartSubtotal(cart));
        setBadge();
      };

      const paypalUrlFor = (amount) => {
        const a = Number(amount || 0).toFixed(2);
        // PayPal.me format: https://www.paypal.me/HANDLE/AMOUNT?currencyCode=USD
        // Note: PayPal does not reliably allow pre-filling the "note" from a static link.
        return `https://www.paypal.me/${encodeURIComponent(PAYPAL_ME_HANDLE)}/${a}?currencyCode=${encodeURIComponent(PAYPAL_CURRENCY)}`;
      };

      const buildOrderSummary = () => {
        const cart = readCart();
        const items = Object.entries(cart)
          .filter(([k,v]) => PRODUCTS[k] && Number(v)>0)
          .map(([k,v]) => `${PRODUCTS[k].name} x${Number(v)}`);
        return items.join(" • ");
      };

      const guardPaypal = () => {
        if (!PAYPAL_ME_HANDLE || PAYPAL_ME_HANDLE === "YOURHANDLE") {
          alert("Set your PayPal.me handle in the code first (PAYPAL_ME_HANDLE).");
          return false;
        }
        return true;
      };

      /* =========================
         WARDS (existing)
         ========================= */
      modal.addEventListener("contextmenu", (e) => { if (modal.classList.contains("open")) e.preventDefault(); });
      mapModal.addEventListener("contextmenu", (e) => { if (mapModal.classList.contains("open")) e.preventDefault(); });
      if (mapsGrid) mapsGrid.addEventListener("contextmenu", (e) => e.preventDefault());

      commissionModal.addEventListener("contextmenu", (e) => { if (commissionModal.classList.contains("open")) e.preventDefault(); });
      commissionLetterModal.addEventListener("contextmenu", (e) => { if (commissionLetterModal.classList.contains("open")) e.preventDefault(); });

      document.addEventListener("dragstart", (e) => {
        if (
          e.target.closest(".maps-grid") ||
          e.target.closest(".modal") ||
          e.target.closest(".packs") ||
          e.target.closest(".creation-grid")
        ) e.preventDefault();
      });

      /* =========================
         CLICK WIRING
         ========================= */
      document.addEventListener("click", (e) => {
        // Add to cart buttons (stop preview)
        const addBtn = e.target.closest("[data-add]");
        if (addBtn) {
          e.preventDefault();
          e.stopPropagation();
          const key = addBtn.getAttribute("data-add");
          addToCart(key, 1);
          // subtle feedback without toast frameworks
          addBtn.textContent = "Added";
          setTimeout(() => { addBtn.textContent = "Add to cart"; }, 850);
          return;
        }

        // Open cart (FAB + inline)
        if (e.target.closest("#openCart") || e.target.closest("#openCartInline")) {
          e.preventDefault();
          openCart();
          return;
        }

        // Packs — open preview (div pack)
        const packEl = e.target.closest(".pack");
        if (packEl && packEl.hasAttribute("data-pack")) {
          // if clicked inside actions, ignore (handled above)
          if (e.target.closest(".pack-actions")) return;
          e.preventDefault();
          e.stopPropagation();
          openModal(packEl.getAttribute("data-pack"));
          return;
        }

        // Pack tiles inside modal
        const tileBtn = e.target.closest(".tile");
        if (tileBtn && modal.classList.contains("open")) {
          e.preventDefault();
          e.stopPropagation();
          openViewer(tileBtn.getAttribute("data-view"));
          return;
        }

        // Map cards
        const mapCard = e.target.closest(".map-card");
        if (mapCard) {
          e.preventDefault();
          e.stopPropagation();
          openMapModal(mapCard.getAttribute("data-map"));
          return;
        }

        // Open commission sequence from button
        if (e.target.closest("#openCommission")) {
          e.preventDefault();
          e.stopPropagation();
          openCommissionModal();
          return;
        }

        // Close controls
        if (e.target.closest("[data-back]")) return backToCollage();
        if (e.target.closest("[data-close]")) return closeModal();

        if (e.target.closest("[data-map-close]")) return closeMapModal();
        if (e.target.closest("[data-map-back]")) return closeMapModal();

        // Cart close
        if (e.target.closest("[data-cart-close]")) return closeCart();

        // Commission close controls
        if (e.target.closest("[data-commission-close]")) { e.preventDefault(); return closeCommissionModals(); }
        if (e.target.closest("[data-letter-close]")) { e.preventDefault(); return closeCommissionModals(); }

        // Cart qty controls
        const plus = e.target.closest("[data-qty-plus]");
        if (plus) {
          e.preventDefault();
          const key = plus.getAttribute("data-qty-plus");
          const c = readCart();
          setQty(key, Number(c[key]||0) + 1);
          renderCart();
          return;
        }
        const minus = e.target.closest("[data-qty-minus]");
        if (minus) {
          e.preventDefault();
          const key = minus.getAttribute("data-qty-minus");
          const c = readCart();
          setQty(key, Number(c[key]||0) - 1);
          renderCart();
          return;
        }
        const rem = e.target.closest("[data-remove]");
        if (rem) {
          e.preventDefault();
          const key = rem.getAttribute("data-remove");
          setQty(key, 0);
          renderCart();
          return;
        }
      });

      // Pack keyboard support (Enter/Space opens preview)
      document.addEventListener("keydown", (e) => {
        if ((e.key === "Enter" || e.key === " ") && document.activeElement && document.activeElement.classList.contains("pack")) {
          e.preventDefault();
          const key = document.activeElement.getAttribute("data-pack");
          if (key) openModal(key);
        }

        // Escape closes whichever modal is open
        if (e.key === "Escape") {
          if (modal.classList.contains("open")) return closeModal();
          if (mapModal.classList.contains("open")) return closeMapModal();
          if (cartModal.classList.contains("open")) return closeCart();
          if (commissionModal.classList.contains("open") || commissionLetterModal.classList.contains("open")) return closeCommissionModals();
        }

        if ((e.key === "Backspace" || e.key === "ArrowLeft")) {
          if (modal.classList.contains("mode-viewer")) {
            e.preventDefault();
            backToCollage();
          } else if (mapModal.classList.contains("open")) {
            e.preventDefault();
            closeMapModal();
          }
        }
      });

      // Commission sequence click
      if (commissionAdvanceBtn) {
        commissionAdvanceBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          playCommissionSequence();
        });
      }

      // mapSlotBtn is an <a>; do NOT preventDefault. Only stop propagation.
      if (mapSlotBtn) mapSlotBtn.addEventListener("click", (e) => e.stopPropagation());

      // Cart buttons
      if (copyOrderBtn) {
        copyOrderBtn.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(currentOrderId);
            copyOrderBtn.textContent = "Copied";
            setTimeout(() => copyOrderBtn.textContent = "Copy", 900);
          } catch {
            alert("Copy failed. Long-press and copy the Order ID.");
          }
        });
      }

      if (payNowBtn) {
        payNowBtn.addEventListener("click", () => {
          if (!guardPaypal()) return;

          const cart = readCart();
          const subtotal = cartSubtotal(cart);
          if (subtotal <= 0) {
            alert("Cart is empty.");
            return;
          }

          const email = (buyerEmail?.value || "").trim();
          const note = (buyerNote?.value || "").trim();
          const summary = buildOrderSummary();

          // This site can't inject the PayPal note reliably.
          // So we *show* the Order ID and instruct the buyer to paste it into PayPal notes.
          // We'll also store a local receipt so returning users can reference it.
          const receipt = {
            orderId: currentOrderId,
            email,
            note,
            summary,
            cart,
            subtotal,
            createdAt: new Date().toISOString()
          };
          try {
            localStorage.setItem("ll_last_receipt_v1", JSON.stringify(receipt));
          } catch {}

          window.open(paypalUrlFor(subtotal), "_blank", "noopener,noreferrer");
        });
      }

      // Init badge on load
      setBadge();
    })();
  </script>
</body>
</html>