<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Pay — Lace & Leather</title>
  <meta name="robots" content="noindex,nofollow" />

  <link rel="stylesheet" href="./styles.css" />
</head>

<body class="pay-page">
  <!-- FIXED BACKGROUND (FIT viewport, no crop) -->
  <div class="bg pay-bg" aria-hidden="true"></div>

  <main class="wrap pay-wrap">
    <section class="glass pay-glass" aria-label="Payment screen">

      <header class="pay-top">
        <div>
          <div class="brand">Lace &amp; Leather</div>
          <div class="muted">Cart + QR checkout (PayPal)</div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
          <button class="mini-btn" type="button" id="backBtn">Back</button>
          <button class="mini-btn" type="button" id="clearBtn">Clear cart</button>
        </div>
      </header>

      <section class="pay-grid">
        <!-- LEFT: CART -->
        <div class="pay-panel">
          <div class="pay-h">Cart</div>
          <div id="cart" class="pay-cart"></div>

          <div class="pay-sumrow">
            <div class="muted">Subtotal</div>
            <strong id="subtotal">$0.00</strong>
          </div>

          <div id="warn" class="pay-warn"></div>
        </div>

        <!-- RIGHT: PAYMENT -->
        <div class="pay-panel">
          <div class="pay-h">Scan to pay</div>

          <div class="pay-amount" id="amount">$0.00</div>

          <div class="pay-qrwrap">
            <img id="qr" class="pay-qr" alt="PayPal QR code" />
          </div>

          <div class="pay-row">
            <span class="muted">Order ID</span>
            <span class="pay-pill">
              <strong id="orderId">—</strong>
              <button class="mini-btn" type="button" id="copyOrder">Copy</button>
            </span>
          </div>

          <div class="muted pay-note">
            In PayPal, paste the Order ID into the note.
          </div>

          <div class="pay-ctas">
            <button class="pay-btn" type="button" id="openPaypal">Open PayPal</button>
            <button class="mini-btn" type="button" id="paidBtn">I paid</button>
          </div>
        </div>
      </section>

      <footer class="pay-fine muted">
        This page replaces your cart modal. Designed for tablet checkout.
      </footer>

    </section>
  </main>

  <script>
    (() => {
      "use strict";

      const PAYPAL_ME_HANDLE = "YOUR_PAYPAL_ME_HANDLE";
      const CART_KEY  = "ll_cart";
      const ORDER_KEY = "ll_order_id";

      const $ = (id) => document.getElementById(id);

      const cartEl = $("cart");
      const subtotalEl = $("subtotal");
      const amountEl = $("amount");
      const orderEl = $("orderId");
      const qrEl = $("qr");
      const warnEl = $("warn");

      let currentPayUrl = "";

      const money = (n) =>
        Number(n || 0).toLocaleString(undefined, { style:"currency", currency:"USD" });

      const safeId = () =>
        Math.random().toString(16).slice(2,6).toUpperCase() + "-" +
        Math.random().toString(16).slice(2,6).toUpperCase();

      const readCart = () => {
        try {
          const raw = localStorage.getItem(CART_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch { return []; }
      };

      const writeCart = (cart) =>
        localStorage.setItem(CART_KEY, JSON.stringify(cart));

      const ensureOrderId = () => {
        let id = localStorage.getItem(ORDER_KEY);
        if (!id) {
          id = safeId();
          localStorage.setItem(ORDER_KEY, id);
        }
        orderEl.textContent = id;
        return id;
      };

      const subtotal = (cart) =>
        cart.reduce((s, i) => s + (i.price || 0) * (i.qty || 1), 0);

      const paypalUrlFor = (amount, orderId) =>
        `https://paypal.me/${PAYPAL_ME_HANDLE}/${amount.toFixed(2)}?note=${encodeURIComponent(orderId)}`;

      const render = () => {
        const cart = readCart();
        const total = subtotal(cart);
        const oid = ensureOrderId();

        subtotalEl.textContent = money(total);
        amountEl.textContent = money(total);
        cartEl.innerHTML = "";

        if (!cart.length) {
          warnEl.textContent = "Cart is empty.";
          warnEl.style.display = "block";
          qrEl.removeAttribute("src");
          return;
        }

        warnEl.style.display = "none";

        cart.forEach((it, i) => {
          const row = document.createElement("div");
          row.className = "pay-item";
          row.innerHTML = `
            <div>
              <div class="pay-item-title">${it.title}</div>
              <div class="muted pay-item-sub">${money(it.price)}</div>
            </div>
            <div class="pay-item-right">
              <button class="qty-btn" data-dec="${i}">−</button>
              <strong>${it.qty}</strong>
              <button class="qty-btn" data-inc="${i}">+</button>
            </div>
          `;
          cartEl.appendChild(row);
        });

        currentPayUrl = paypalUrlFor(total, oid);
        qrEl.src =
          "https://api.qrserver.com/v1/create-qr-code/?size=520x520&margin=10&data=" +
          encodeURIComponent(currentPayUrl);
      };

      document.addEventListener("click", (e) => {
        const cart = readCart();

        if (e.target.dataset.inc) {
          cart[e.target.dataset.inc].qty++;
          writeCart(cart); render();
        }
        if (e.target.dataset.dec) {
          cart[e.target.dataset.dec].qty =
            Math.max(1, cart[e.target.dataset.dec].qty - 1);
          writeCart(cart); render();
        }
      });

      $("copyOrder").onclick = () =>
        navigator.clipboard.writeText(orderEl.textContent);

      $("openPaypal").onclick = () =>
        window.open(currentPayUrl, "_blank");

      $("paidBtn").onclick = () =>
        window.location.href = "./index.html";

      $("clearBtn").onclick = () => {
        localStorage.removeItem(CART_KEY);
        localStorage.removeItem(ORDER_KEY);
        render();
      };

      $("backBtn").onclick = () =>
        window.location.href = "./index.html";

      render();
    })();
  </script>
</body>
</html>