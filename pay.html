<!-- pay.html (FULL) — Lace & Leather / Tablet Pay Screen (Viewport-fit + Scroll + Screen-rect tuned) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pay — Lace & Leather</title>
  <meta name="robots" content="noindex,nofollow" />

  <!-- Clean readable font for pay page -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --text:#efe9df;
      --muted: rgba(239,233,223,.78);

      /* tablet screen rectangle (tucked in slightly on the sides) */
      --screenLeft: 14.7%;
      --screenTop:  23.0%;
      --screenW:    70.8%;
      --screenH:    56.5%;

      --glow: rgba(0,0,0,.78);
      --line: rgba(255,255,255,.16);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:#05060a;
      color:var(--text);
      font-family:"Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    /* full-viewport stage */
    .stage{
      position:fixed;
      inset:0;
      display:grid;
      place-items:center;
      padding:
        max(10px, env(safe-area-inset-top))
        max(10px, env(safe-area-inset-right))
        max(10px, env(safe-area-inset-bottom))
        max(10px, env(safe-area-inset-left));
      background:
        radial-gradient(1200px 600px at 50% 30%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(900px 900px at 50% 70%, rgba(0,0,0,.18), rgba(0,0,0,.88));
    }

    /* IMPORTANT: scale tablet by HEIGHT so it always fits viewport */
    .tablet{
      position:relative;

      height: min(92vh, 760px);
      width: auto;
      aspect-ratio: 16 / 9;

      background: url("./assets/tablet-web.png") center / contain no-repeat;
      filter: brightness(1.10) contrast(1.06) saturate(1.05);
      transform: translateZ(0);

      max-width: 96vw;
      max-height: 92vh;
    }

    @media (max-width: 768px){
      .tablet{
        height: min(90vh, 560px);
        background: url("./assets/tablet-mobile.png") center / contain no-repeat;
      }

      /* mobile screen rect (also tucked in slightly) */
      :root{
        --screenLeft: 14.2%;
        --screenTop:  22.7%;
        --screenW:    71.6%;
        --screenH:    57.2%;
      }
    }

    /* UI pinned to “screen area” INSIDE the tablet */
    .screen{
      position:absolute;
      left: var(--screenLeft);
      top:  var(--screenTop);
      width: var(--screenW);
      height:var(--screenH);

      display:flex;
      flex-direction:column;
      gap:12px;

      padding:14px;
      background: transparent;

      /* ✅ scroll if content exceeds tablet screen */
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Top bar */
    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      /* keep topbar visible above scroll content */
      position:sticky;
      top:0;
      z-index:2;
      padding-bottom:8px;
      background: linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,0));
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
    }

    .brand{
      text-align:left;
      line-height:1.15;
      text-shadow: 0 2px 12px var(--glow);
    }
    .brand .name{
      font-weight:800;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:13px;
    }
    .brand .sub{
      margin-top:4px;
      color:var(--muted);
      font-size:12px;
      font-weight:600;
    }

    .actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.18);
      color: var(--text);
      border-radius: 10px;
      padding:9px 12px;
      font-weight:700;
      font-size:12px;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
    .btn:active{ transform: scale(.99); }

    /* Main layout */
    .grid{
      flex:0 0 auto;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
      align-items:start;
      min-height:0;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns:1fr; }
    }

    /* Transparent panels */
    .panel{
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px;
      background: transparent;
      box-shadow:none;
      padding:12px;

      display:flex;
      flex-direction:column;
      gap:10px;

      /* ✅ allow panel to scroll internally if needed */
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }

    .h{
      font-weight:800;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:11px;
      opacity:.92;
      text-shadow: 0 2px 12px var(--glow);
      margin:0;
      text-align:center;
    }

    .cart{
      display:grid;
      gap:10px;
    }

    .item{
      border:1px solid rgba(255,255,255,.14);
      border-radius:12px;
      background: transparent;
      padding:10px;
      display:grid;
      gap:8px;
    }

    .item-title{
      font-weight:800;
      font-size:13px;
      text-shadow: 0 2px 12px var(--glow);
    }
    .item-sub{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
      text-shadow: 0 2px 12px var(--glow);
    }

    .controls{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      flex-wrap:wrap;
    }

    .qty{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(255,255,255,.18);
      border-radius:999px;
      padding:6px 10px;
      background: rgba(0,0,0,.14);
    }

    .qbtn{
      width:32px;
      height:32px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.20);
      color:var(--text);
      cursor:pointer;
      font-weight:900;
      font-size:16px;
      line-height:1;
    }

    .qtynum{
      min-width:22px;
      text-align:center;
      font-weight:800;
    }

    .remove{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--text);
      border-radius:999px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:800;
      font-size:11px;
    }

    .sumrow{
      padding-top:10px;
      border-top:1px solid rgba(255,255,255,.14);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      text-shadow: 0 2px 12px var(--glow);
      font-size:12px;
    }

    /* Pay side */
    .amount{
      font-size: clamp(30px, 4.2vw, 54px);
      font-weight:900;
      letter-spacing:.04em;
      text-align:center;
      text-shadow: 0 2px 14px var(--glow);
      margin: 0;
    }

    .qr-wrap{
      display:flex;
      justify-content:center;
      padding:2px 0 0;
    }

    .qr{
      width:min(300px, 52vw);
      height:auto;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.16);
      box-shadow: 0 18px 40px rgba(0,0,0,.55);
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      font-size:12px;
      color:var(--muted);
      text-shadow: 0 2px 12px var(--glow);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.14);
      color: var(--text);
    }

    .mini{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--text);
      border-radius:999px;
      padding:7px 10px;
      cursor:pointer;
      font-weight:900;
      font-size:11px;
    }

    .cta{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }

    .primary{
      border-color: rgba(255,255,255,.28);
      background: rgba(255,255,255,.10);
      color: var(--text);
    }

    .warn{
      font-size:12px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(140, 20, 20, .16);
      display:none;
      text-shadow: 0 2px 12px var(--glow);
      text-align:center;
    }

    .fine{
      margin-top:10px;
      font-size:11px;
      color: rgba(239,233,223,.70);
      text-shadow: 0 2px 12px var(--glow);
      text-align:center;
      padding-bottom:6px;
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="tablet" aria-hidden="true">
      <section class="screen" aria-label="Payment screen UI">

        <div class="topbar">
          <div class="brand">
            <div class="name">Lace &amp; Leather</div>
            <div class="sub">Cart + QR checkout (PayPal)</div>
          </div>

          <div class="actions">
            <button class="btn" type="button" id="backBtn">Back</button>
            <button class="btn" type="button" id="clearBtn">Clear cart</button>
          </div>
        </div>

        <div class="grid">
          <!-- LEFT: CART -->
          <div class="panel">
            <p class="h">Cart</p>
            <div class="cart" id="cart"></div>

            <div class="sumrow">
              <div style="color:var(--muted); font-weight:800;">Subtotal</div>
              <div style="font-weight:900;" id="subtotal">$0.00</div>
            </div>

            <div id="warn" class="warn"></div>
          </div>

          <!-- RIGHT: PAY -->
          <div class="panel">
            <p class="h">Scan to pay</p>

            <p class="amount" id="amount">$0.00</p>

            <div class="qr-wrap">
              <img id="qr" class="qr" alt="PayPal QR code" src="./assets/lace-qr.png" />
            </div>

            <div class="row">
              <span>Order ID</span>
              <span class="pill">
                <strong id="orderId">—</strong>
                <button class="mini" type="button" id="copyOrder">Copy</button>
              </span>
            </div>

            <div class="row" style="font-size:11px;">
              In PayPal, paste the Order ID into the note.
            </div>

            <div class="cta">
              <button class="btn primary" type="button" id="openPaypal">Open PayPal</button>
              <button class="btn" type="button" id="paidBtn">I paid</button>
            </div>
          </div>
        </div>

        <div class="fine">
          This page replaces your cart modal: edit quantities here, then scan/pay. Designed for the counter tablet.
        </div>

      </section>
    </div>
  </div>

  <script>
    (() => {
      "use strict";

      // === CONFIG ===
      const PAYPAL_ME_HANDLE = "YOUR_PAYPAL_ME_HANDLE"; // <-- set this
      const LOCAL_QR_SRC = "./assets/lace-qr.png";

      // Storage keys (must match index.html)
      const CART_KEY  = "ll_cart";
      const ORDER_KEY = "ll_order_id";

      const $ = (id) => document.getElementById(id);

      const cartEl = $("cart");
      const subtotalEl = $("subtotal");
      const amountEl = $("amount");
      const orderEl = $("orderId");
      const qrEl = $("qr");
      const warnEl = $("warn");

      let currentPayUrl = "";

      const money = (n) => {
        const x = Number(n || 0);
        return x.toLocaleString(undefined, { style:"currency", currency:"USD" });
      };

      const safeId = () =>
        Math.random().toString(16).slice(2, 6).toUpperCase() + "-" +
        Math.random().toString(16).slice(2, 6).toUpperCase();

      const setWarn = (msg) => {
        warnEl.textContent = msg;
        warnEl.style.display = msg ? "block" : "none";
      };

      const readCart = () => {
        try{
          const raw = localStorage.getItem(CART_KEY);
          const arr = raw ? JSON.parse(raw) : [];
          return Array.isArray(arr) ? arr : [];
        }catch{ return []; }
      };

      const writeCart = (cart) => {
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
      };

      const subtotal = (cart) =>
        cart.reduce((sum, it) => {
          const price = Number(it && it.price) || 0;
          const qty = Math.max(1, Number(it && it.qty) || 1);
          return sum + price * qty;
        }, 0);

      const ensureOrderId = () => {
        let id = localStorage.getItem(ORDER_KEY);
        if (!id || id === "—") {
          id = safeId();
          localStorage.setItem(ORDER_KEY, id);
        }
        orderEl.textContent = id;
        return id;
      };

      const paypalUrlFor = (amount, orderId) => {
        const base = `https://paypal.me/${encodeURIComponent(PAYPAL_ME_HANDLE)}/${Number(amount).toFixed(2)}`;
        return `${base}?utm_source=laceleatherarcane&utm_medium=tabletpay&utm_campaign=${encodeURIComponent(orderId)}`;
      };

      const escapeHtml = (s) =>
        String(s).replace(/[&<>"']/g, (c) => ({
          "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;"
        }[c]));

      const render = () => {
        const cart = readCart();
        const total = subtotal(cart);
        const oid = ensureOrderId();

        subtotalEl.textContent = money(total);
        amountEl.textContent = money(total);

        cartEl.innerHTML = "";

        if (!PAYPAL_ME_HANDLE || PAYPAL_ME_HANDLE === "YOUR_PAYPAL_ME_HANDLE") {
          setWarn("Set your PayPal.me handle in pay.html (PAYPAL_ME_HANDLE).");
          currentPayUrl = "";
        } else if (total <= 0) {
          setWarn("Cart is empty. Go back and add items.");
          currentPayUrl = "";
        } else {
          setWarn("");
          currentPayUrl = paypalUrlFor(total, oid);
        }

        qrEl.src = LOCAL_QR_SRC;

        if (!cart.length) {
          cartEl.innerHTML = `<div style="color:var(--muted); text-align:center; padding:10px 0;">
            No items yet.
          </div>`;
        } else {
          cart.forEach((it, idx) => {
            const title = (it && it.title) ? String(it.title) : "Item";
            const price = Number(it && it.price) || 0;
            const qty = Math.max(1, Number(it && it.qty) || 1);

            const row = document.createElement("div");
            row.className = "item";
            row.innerHTML = `
              <div>
                <div class="item-title">${escapeHtml(title)}</div>
                <div class="item-sub">${money(price)} each</div>
              </div>

              <div class="controls">
                <div class="qty">
                  <button class="qbtn" data-dec="${idx}" type="button">−</button>
                  <div class="qtynum">${qty}</div>
                  <button class="qbtn" data-inc="${idx}" type="button">+</button>
                </div>
                <button class="remove" data-rm="${idx}" type="button">Remove</button>
              </div>
            `;
            cartEl.appendChild(row);
          });
        }
      };

      document.addEventListener("click", (e) => {
        const cart = readCart();

        const inc = e.target.closest("[data-inc]");
        if (inc) {
          const i = Number(inc.getAttribute("data-inc"));
          if (cart[i]) cart[i].qty = Math.max(1, (Number(cart[i].qty)||1) + 1);
          writeCart(cart);
          render();
          return;
        }

        const dec = e.target.closest("[data-dec]");
        if (dec) {
          const i = Number(dec.getAttribute("data-dec"));
          if (cart[i]) cart[i].qty = Math.max(1, (Number(cart[i].qty)||1) - 1);
          writeCart(cart);
          render();
          return;
        }

        const rm = e.target.closest("[data-rm]");
        if (rm) {
          const i = Number(rm.getAttribute("data-rm"));
          cart.splice(i, 1);
          writeCart(cart);
          render();
        }
      });

      $("copyOrder").addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(orderEl.textContent.trim());
          setWarn("Order ID copied.");
          setTimeout(() => setWarn(""), 900);
        } catch {
          setWarn("Couldn't copy automatically. Tap and hold to copy the Order ID.");
        }
      });

      $("openPaypal").addEventListener("click", () => {
        if (!currentPayUrl) return;
        window.open(currentPayUrl, "_blank", "noopener,noreferrer");
      });

      $("paidBtn").addEventListener("click", () => {
        window.location.href = "./index.html";
      });

      $("clearBtn").addEventListener("click", () => {
        localStorage.removeItem(CART_KEY);
        localStorage.removeItem(ORDER_KEY);
        render();
      });

      $("backBtn").addEventListener("click", () => {
        window.location.href = "./index.html";
      });

      render();
    })();
  </script>
</body>
</html>