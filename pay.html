<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Lace & Leather — Pay</title>
  <meta name="robots" content="noindex,nofollow" />

  <!-- Clean, readable font just for pay screen -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- IMPORTANT: bump this version any time you edit styles.css -->
  <link rel="stylesheet" href="styles.css?v=20260203-2">
</head>

<body class="pay-page">
  <main class="pay-shell">
    <div class="tablet-wrap">

      <!-- Desktop tablet -->
      <img
        class="tablet-img tablet-desktop"
        src="./assets/tablet-web.png"
        alt=""
        aria-hidden="true"
      />

      <!-- Mobile tablet -->
      <img
        class="tablet-img tablet-mobile"
        src="./assets/tablet-mobile.png"
        alt=""
        aria-hidden="true"
      />

      <!-- SCREEN (clipped to tablet interior) -->
      <section class="tablet-screen">
        <!-- HEADER -->
        <header class="pay-head">
          <div>
            <div class="pay-brand">LACE &amp; LEATHER</div>
            <div class="pay-sub">Cart + QR checkout (PayPal)</div>
          </div>

          <div class="pay-actions">
            <a class="pay-btn" href="./index.html">Back</a>
            <button class="pay-btn" id="clearCart" type="button">Clear cart</button>
          </div>
        </header>

        <!-- SCROLLABLE CONTENT -->
        <div class="pay-scroll">
          <div class="pay-grid">
            <!-- CART -->
            <section class="pay-card">
              <h2>CART</h2>

              <p class="pay-muted" id="emptyMsg">Cart is empty.</p>

              <!-- NEW: actual cart items list (forces real scrolling when cart grows) -->
              <ul class="pay-items" id="cartList" aria-label="Cart items"></ul>

              <div class="pay-row">
                <span>Subtotal</span>
                <strong id="subtotal">$0.00</strong>
              </div>

              <div class="pay-row">
                <span>Order ID</span>
                <span class="pay-order">
                  <code id="orderId">—</code>
                  <button class="pay-mini" id="copyOrder" type="button">Copy</button>
                </span>
              </div>

              <p class="pay-note">
                Review items, then scan/pay. (This replaces your cart modal.)
              </p>
            </section>

            <!-- QR -->
            <section class="pay-card">
              <div class="pay-row pay-row-top">
                <h2>SCAN TO PAY</h2>
                <strong class="pay-total" id="total">$0.00</strong>
              </div>

              <div class="pay-qr-wrap">
                <img
                  src="./assets/lace-qr.png"
                  class="pay-qr"
                  alt="PayPal QR code"
                />
              </div>

              <p class="pay-muted">
                Open PayPal → Scan → Pay exact total.
              </p>
            </section>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    (() => {
      const CART_KEY = "ll_cart";
      const ORDER_KEY = "ll_order_id";

      const subtotalEl = document.getElementById("subtotal");
      const totalEl = document.getElementById("total");
      const orderEl = document.getElementById("orderId");
      const emptyMsg = document.getElementById("emptyMsg");
      const cartList = document.getElementById("cartList");

      const money = n =>
        Number(n).toLocaleString(undefined, { style:"currency", currency:"USD" });

      const safeId = () =>
        Math.random().toString(16).slice(2,6).toUpperCase() + "-" +
        Math.random().toString(16).slice(2,6).toUpperCase();

      const cart = (() => {
        try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
        catch { return []; }
      })();

      // Render items
      const renderCart = (items) => {
        if (!cartList) return;
        cartList.innerHTML = "";

        items.forEach((i) => {
          const name = (i && i.name) ? String(i.name) : "Item";
          const qty  = (i && i.qty) ? Number(i.qty) : 1;
          const price = (i && i.price) ? Number(i.price) : 0;

          const li = document.createElement("li");
          li.className = "pay-item";
          li.innerHTML = `
            <span class="pay-item-name">${name}</span>
            <span class="pay-item-meta">
              <span class="pay-item-qty">×${qty}</span>
              <span class="pay-item-price">${money(price * qty)}</span>
            </span>
          `;
          cartList.appendChild(li);
        });
      };

      let total = cart.reduce((s,i)=>s+(i.price||0)*(i.qty||1),0);

      subtotalEl.textContent = money(total);
      totalEl.textContent = money(total);

      if (!cart.length) {
        emptyMsg.style.display = "block";
        if (cartList) cartList.style.display = "none";
      } else {
        emptyMsg.style.display = "none";
        if (cartList) cartList.style.display = "block";
        renderCart(cart);
      }

      let oid = localStorage.getItem(ORDER_KEY);
      if (!oid || oid === "—") {
        oid = safeId();
        localStorage.setItem(ORDER_KEY, oid);
      }
      orderEl.textContent = oid;

      document.getElementById("copyOrder").onclick = () =>
        navigator.clipboard.writeText(oid);

      document.getElementById("clearCart").onclick = () => {
        localStorage.removeItem(CART_KEY);
        localStorage.removeItem(ORDER_KEY);
        location.reload();
      };
    })();
  </script>
</body>
</html>