<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Pay — Lace & Leather</title>
  <meta name="robots" content="noindex,nofollow" />

  <style>
    :root{
      --text:#e7e2db;
      --muted: rgba(231,226,219,.80);
      --line: rgba(255,255,255,.12);
      --shadow: 0 18px 48px rgba(0,0,0,.55);
      --radius:18px;
      --bgDim:.62;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-serif, Georgia, serif;
      background:#06070a;
      text-align:center;
      overflow:auto;
    }

    .bg{
      position:fixed;
      inset:0;
      z-index:-2;
      background:url("./assets/tablet-web.png") center / cover no-repeat;
      filter:saturate(1.08) contrast(1.02) brightness(1.08);
    }
    .bg::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(120% 90% at 50% 12%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(120% 120% at 50% 50%, transparent 55%, rgba(0,0,0,.70) 100%),
        linear-gradient(180deg, rgba(0,0,0,var(--bgDim)), rgba(0,0,0,var(--bgDim)));
    }
    @media (max-width: 768px){
      .bg{ background:url("./assets/tablet-mobile.png") center top / cover no-repeat; }
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:18px;
    }

    .glass{
      position:relative;
      width:min(980px, 96vw);
      padding:18px;
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      background:
        linear-gradient(180deg, rgba(255,255,255,.08), transparent 42%),
        linear-gradient(180deg, rgba(12,14,18,.10), rgba(12,14,18,.16));
      backdrop-filter: blur(6px) saturate(1.03);
      -webkit-backdrop-filter: blur(6px) saturate(1.03);
      display:grid;
      gap:14px;
      margin: 22px 0 40px;
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .brand{
      font-weight:700;
      letter-spacing:.14em;
      text-transform:uppercase;
      opacity:.95;
    }

    .muted{ color:var(--muted); }

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.22);
      color:var(--text);
      border-radius:999px;
      padding:12px 16px;
      cursor:pointer;
      box-shadow: 0 12px 26px rgba(0,0,0,.40);
      min-width: 180px;
    }
    .btn.primary{
      border-color: rgba(255,255,255,.22);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.22));
    }
    .btn.small{ padding:10px 12px; min-width:unset; }
    .btn:active{ transform: scale(.99); }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .panel{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      background: rgba(0,0,0,.14);
      padding:14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.30);
      display:grid;
      gap:12px;
    }

    .h{
      font-weight:700;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size: 13px;
      opacity:.92;
    }

    .amount{
      font-size: clamp(46px, 6vw, 78px);
      line-height:1;
      letter-spacing:.06em;
      text-shadow:0 0 14px rgba(0,0,0,.9);
      margin-top:2px;
    }

    .qr-wrap{
      display:flex;
      justify-content:center;
      padding:6px 0 2px;
    }
    .qr{
      width:min(360px, 70vw);
      height:auto;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      box-shadow:0 22px 54px rgba(0,0,0,.60);
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      font-size:15px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.14);
    }

    .mini{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.20);
      color:var(--text);
      border-radius:999px;
      padding:9px 12px;
      cursor:pointer;
    }

    .warn{
      font-size:14px;
      opacity:.96;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(140, 20, 20, .16);
      display:none;
      text-shadow:0 0 8px rgba(0,0,0,.85);
    }

    /* Cart list */
    .cart{
      display:grid;
      gap:10px;
      text-align:left;
    }

    .item{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
    }

    .item-title{
      font-weight:700;
      letter-spacing:.02em;
    }
    .item-sub{ font-size:13px; color:var(--muted); margin-top:2px; }

    .controls{
      display:flex;
      align-items:center;
      gap:8px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    .qty{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(255,255,255,.14);
      border-radius:999px;
      padding:8px 10px;
      background: rgba(0,0,0,.12);
    }

    .qbtn{
      width:36px;
      height:36px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      color:var(--text);
      cursor:pointer;
      font-weight:700;
    }
    .qbtn:active{ transform: scale(.99); }

    .qtynum{
      min-width: 20px;
      text-align:center;
      font-weight:700;
    }

    .sumrow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding-top:8px;
      border-top:1px solid rgba(255,255,255,.12);
    }

    .fine{
      font-size:13px;
      opacity:.92;
      max-width:860px;
      margin:0 auto;
      text-shadow:0 0 8px rgba(0,0,0,.85);
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="wrap">
    <section class="glass" aria-label="Payment screen">
      <div class="top">
        <div>
          <div class="brand">Lace &amp; Leather</div>
          <div class="muted">Cart + QR checkout (PayPal)</div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
          <button class="btn small" type="button" id="backBtn">Back</button>
          <button class="btn small" type="button" id="clearBtn">Clear cart</button>
        </div>
      </div>

      <div class="grid">
        <!-- LEFT: CART -->
        <div class="panel">
          <div class="h">Cart</div>
          <div class="cart" id="cart"></div>

          <div class="sumrow">
            <div class="muted">Subtotal</div>
            <strong id="subtotal">$0.00</strong>
          </div>

          <div id="warn" class="warn"></div>
        </div>

        <!-- RIGHT: PAY -->
        <div class="panel">
          <div class="h">Scan to pay</div>

          <div class="amount" id="amount">$0.00</div>

          <div class="qr-wrap">
            <img id="qr" class="qr" alt="PayPal QR code" />
          </div>

          <div class="row">
            <span class="muted">Order ID</span>
            <span class="pill">
              <strong id="orderId">—</strong>
              <button class="mini" type="button" id="copyOrder">Copy</button>
            </span>
          </div>

          <div class="row muted" style="font-size:13px;">
            In PayPal, paste the Order ID into the note.
          </div>

          <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-top:6px;">
            <button class="btn primary" type="button" id="openPaypal">Open PayPal on this device</button>
            <button class="btn" type="button" id="paidBtn">I paid</button>
          </div>
        </div>
      </div>

      <div class="fine muted">
        This page replaces your cart modal: edit quantities here, then scan/pay. Designed for a tablet at the counter.
      </div>
    </section>
  </div>

  <script>
    (() => {
      "use strict";

      // === CONFIG ===
      const PAYPAL_ME_HANDLE = "YOUR_PAYPAL_ME_HANDLE"; // <-- set this

      // Storage keys (MUST match your main site)
      const CART_KEY  = "ll_cart";
      const ORDER_KEY = "ll_order_id";

      const $ = (id) => document.getElementById(id);

      const cartEl = $("cart");
      const subtotalEl = $("subtotal");
      const amountEl = $("amount");
      const orderEl = $("orderId");
      const qrEl = $("qr");
      const warnEl = $("warn");

      let currentPayUrl = "";

      const money = (n) => {
        const x = Number(n || 0);
        return x.toLocaleString(undefined, { style:"currency", currency:"USD" });
      };

      const safeId = () =>
        Math.random().toString(16).slice(2, 6).toUpperCase() + "-" +
        Math.random().toString(16).slice(2, 6).toUpperCase();

      const setWarn = (msg) => {
        warnEl.textContent = msg;
        warnEl.style.display = msg ? "block" : "none";
      };

      const readCart = () => {
        try{
          const raw = localStorage.getItem(CART_KEY);
          const arr = raw ? JSON.parse(raw) : [];
          return Array.isArray(arr) ? arr : [];
        }catch{ return []; }
      };

      const writeCart = (cart) => {
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
      };

      const subtotal = (cart) =>
        cart.reduce((sum, it) => {
          const price = Number(it && it.price) || 0;
          const qty = Math.max(1, Number(it && it.qty) || 1);
          return sum + price * qty;
        }, 0);

      const ensureOrderId = () => {
        let id = localStorage.getItem(ORDER_KEY);
        if (!id || id === "—") {
          id = safeId();
          localStorage.setItem(ORDER_KEY, id);
        }
        orderEl.textContent = id;
        return id;
      };

      const paypalUrlFor = (amount, orderId) => {
        const base = `https://paypal.me/${encodeURIComponent(PAYPAL_ME_HANDLE)}/${Number(amount).toFixed(2)}`;
        return `${base}?utm_source=laceleatherarcane&utm_medium=tabletpay&utm_campaign=${encodeURIComponent(orderId)}`;
      };

      const render = () => {
        const cart = readCart();
        const total = subtotal(cart);
        const oid = ensureOrderId();

        subtotalEl.textContent = money(total);
        amountEl.textContent = money(total);

        cartEl.innerHTML = "";

        if (!PAYPAL_ME_HANDLE || PAYPAL_ME_HANDLE === "YOUR_PAYPAL_ME_HANDLE") {
          setWarn("Set your PayPal.me handle in pay.html (PAYPAL_ME_HANDLE).");
        } else if (total <= 0) {
          setWarn("Cart is empty. Go back and add items.");
        } else {
          setWarn("");
        }

        if (!cart.length) {
          cartEl.innerHTML = `<div class="muted" style="padding:10px; text-align:center;">
            No items yet.
          </div>`;
        } else {
          cart.forEach((it, idx) => {
            const title = (it && it.title) ? String(it.title) : "Item";
            const price = Number(it && it.price) || 0;
            const qty = Math.max(1, Number(it && it.qty) || 1);

            const row = document.createElement("div");
            row.className = "item";
            row.innerHTML = `
              <div>
                <div class="item-title">${escapeHtml(title)}</div>
                <div class="item-sub muted">${money(price)} each</div>
              </div>

              <div class="controls">
                <div class="qty" aria-label="Quantity controls">
                  <button class="qbtn" data-dec="${idx}" type="button" aria-label="Decrease quantity">−</button>
                  <div class="qtynum" aria-label="Quantity">${qty}</div>
                  <button class="qbtn" data-inc="${idx}" type="button" aria-label="Increase quantity">+</button>
                </div>
                <button class="btn small" data-rm="${idx}" type="button">Remove</button>
              </div>
            `;
            cartEl.appendChild(row);
          });
        }

        // QR + link
        if (PAYPAL_ME_HANDLE && PAYPAL_ME_HANDLE !== "YOUR_PAYPAL_ME_HANDLE" && total > 0) {
          currentPayUrl = paypalUrlFor(total, oid);
          const qrUrl =
            "https://api.qrserver.com/v1/create-qr-code/?size=520x520&margin=10&data=" +
            encodeURIComponent(currentPayUrl);

          qrEl.src = qrUrl;
        } else {
          currentPayUrl = "";
          qrEl.removeAttribute("src");
        }
      };

      const escapeHtml = (s) =>
        s.replace(/[&<>"']/g, (c) => ({
          "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;"
        }[c]));

      // Events
      document.addEventListener("click", (e) => {
        const cart = readCart();

        const inc = e.target.closest("[data-inc]");
        if (inc) {
          const i = Number(inc.getAttribute("data-inc"));
          if (cart[i]) cart[i].qty = Math.max(1, (Number(cart[i].qty)||1) + 1);
          writeCart(cart);
          render();
          return;
        }

        const dec = e.target.closest("[data-dec]");
        if (dec) {
          const i = Number(dec.getAttribute("data-dec"));
          if (cart[i]) cart[i].qty = Math.max(1, (Number(cart[i].qty)||1) - 1);
          writeCart(cart);
          render();
          return;
        }

        const rm = e.target.closest("[data-rm]");
        if (rm) {
          const i = Number(rm.getAttribute("data-rm"));
          cart.splice(i, 1);
          writeCart(cart);
          render();
          return;
        }
      });

      $("copyOrder").addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(orderEl.textContent.trim());
          setWarn("Order ID copied.");
          setTimeout(() => setWarn(""), 1100);
        } catch {
          setWarn("Couldn't copy automatically. Tap and hold to copy the Order ID.");
        }
      });

      $("openPaypal").addEventListener("click", () => {
        if (!currentPayUrl) return;
        window.open(currentPayUrl, "_blank", "noopener,noreferrer");
      });

      $("paidBtn").addEventListener("click", () => {
        // OPTIONAL: clear cart after payment confirmation:
        // localStorage.removeItem(CART_KEY);
        // localStorage.removeItem(ORDER_KEY);

        window.location.href = "./index.html";
      });

      $("clearBtn").addEventListener("click", () => {
        localStorage.removeItem(CART_KEY);
        // keep order id or reset it—your choice. I reset it:
        localStorage.removeItem(ORDER_KEY);
        render();
      });

      $("backBtn").addEventListener("click", () => {
        window.location.href = "./index.html";
      });

      // Init
      render();
    })();
  </script>
</body>
</html>